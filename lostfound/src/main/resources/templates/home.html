<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Home</title>
    <style>
        :root{
            --bg:#333333;

            /* Dark surfaces */
            --surface:#1f1f1f;
            --card:#242424;

            /* Text */
            --text:#f3f4f6;
            --muted:#b3b3b3;

            /* Borders + shadow */
            --border:#3a3a3a;
            --shadow: 0 14px 40px rgba(0,0,0,.35);

            /* Accents */
            --primary:#7c3aed;   /* purple */
            --primary-2:#0ea5e9;
            --danger:#ff4d6d;

            --open:#22c55e;
            --resolved:#ff4d6d;
        }

        *{box-sizing:border-box}
        html, body{min-height:100%}

        body{
            margin:0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
            background:var(--bg);
            color:var(--text);
        }

        .container{max-width:1100px;margin:0 auto;padding:18px;}

        /* TOPBAR */
        .topbar{
            background:rgba(31,31,31,.92);
            backdrop-filter: blur(10px);
            border-bottom:1px solid var(--border);
            position:sticky; top:0; z-index:50;
        }
        .topbar-inner{
            display:flex; align-items:center; gap:14px;
            max-width:1100px; margin:0 auto; padding:12px 18px;
        }
        .brand{
            font-weight:900;
            letter-spacing:.2px;
            text-decoration:none;
            color:var(--text);
            display:flex; align-items:center; gap:10px;
        }
        .brand-badge{
            width:34px;height:34px;border-radius:10px;
            background:linear-gradient(135deg, rgba(124,58,237,.35), rgba(255,255,255,.06));
            border:1px solid rgba(124,58,237,.35);
            display:grid;place-items:center;
            box-shadow: 0 10px 22px rgba(0,0,0,.35);
            font-weight:900;
            color:var(--text);
        }
        .nav-links{margin-left:auto; display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
        .link{
            text-decoration:none;
            color:var(--text);
            padding:8px 10px;
            border-radius:10px;
            border:1px solid transparent;
        }
        .link:hover{
            background:rgba(255,255,255,.06);
            border-color:rgba(255,255,255,.08);
        }

        .btn{
            appearance:none;
            border:1px solid rgba(255,255,255,.10);
            background:rgba(255,255,255,.06);
            color:var(--text);
            padding:8px 12px;
            border-radius:10px;
            cursor:pointer;
            font-weight:800;
        }
        .btn:hover{background:rgba(255,255,255,.10)}
        .btn-primary{
            background:var(--primary);
            border-color:var(--primary);
            color:#fff;
        }
        .btn-primary:hover{filter:brightness(.95)}
        .btn-danger{
            background:rgba(255,77,109,.10);
            border-color:rgba(255,77,109,.35);
            color:#ffd1da;
        }
        .btn-danger:hover{background:rgba(255,77,109,.16)}

        /* FILTER + SEARCH */
        .panel{
            background:rgba(31,31,31,.88);
            border:1px solid var(--border);
            border-radius:18px;
            box-shadow:var(--shadow);
            padding:14px;
        }
        .filters{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
        .pill{
            display:inline-flex; align-items:center; gap:8px;
            padding:8px 12px;
            border-radius:999px;
            border:1px solid rgba(255,255,255,.10);
            background:rgba(255,255,255,.06);
            text-decoration:none;
            color:var(--text);
            font-weight:900;
            font-size:13px;
        }
        .pill:hover{background:rgba(255,255,255,.10)}
        .pill.active{
            border-color:rgba(124,58,237,.55);
            background:rgba(124,58,237,.18);
        }

        .search{
            margin-top:12px;
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            align-items:center;
        }
        .input{
            flex:1;
            min-width:240px;
            border:1px solid rgba(255,255,255,.12);
            border-radius:12px;
            padding:10px 12px;
            outline:none;
            background:rgba(0,0,0,.25);
            color:var(--text);
        }
        .input::placeholder{color:rgba(243,244,246,.55)}
        .input:focus{
            border-color:rgba(124,58,237,.65);
            box-shadow:0 0 0 3px rgba(124,58,237,.22)
        }
        .small{font-size:13px;color:rgba(243,244,246,.65)}

        /* GRID */
        .grid{
            margin-top:16px;
            display:grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap:14px;
        }
        .card{
            background:var(--card);
            border:1px solid rgba(255,255,255,.10);
            border-radius:18px;
            box-shadow:var(--shadow);
            overflow:hidden;
            display:flex;
            flex-direction:column;
            transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
        }
        .card:hover{
            transform: translateY(-2px);
            border-color: rgba(124,58,237,.25);
            box-shadow: 0 18px 55px rgba(0,0,0,.42);
        }

        .card-body{padding:14px;}
        .badges{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px;}
        .badge{
            padding:4px 10px;
            border-radius:999px;
            font-size:12px;
            display:inline-block;
            font-weight:900;
            border:1px solid rgba(255,255,255,.12);
            background:rgba(255,255,255,.06);
            color:var(--text);
        }
        .badge-type-lost{background:rgba(251,146,60,.14);border-color:rgba(251,146,60,.35);color:#ffedd5;}
        .badge-type-found{background:rgba(59,130,246,.14);border-color:rgba(59,130,246,.35);color:#dbeafe;}

        .badge-open{color:#dcfce7; border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.12);}
        .badge-resolved{color:#ffe4ea; border-color:rgba(255,77,109,.35); background:rgba(255,77,109,.12);}

        .title{margin:0 0 10px 0; font-size:16px; font-weight:900; letter-spacing:.2px;}
        .meta{color:rgba(243,244,246,.72); font-size:13px; line-height:1.35;}

        .thumb{
            width:100%;
            height:180px;
            object-fit:cover;
            display:block;
            border-top:1px solid rgba(255,255,255,.08);
            background:rgba(255,255,255,.06);
        }
        .card-actions{
            padding:12px 14px 14px 14px;
            display:flex; gap:10px; align-items:center;
        }
        .a{
            text-decoration:none;
            font-weight:900;
            color:var(--text);
            border:1px solid rgba(255,255,255,.12);
            padding:8px 12px;
            border-radius:12px;
            background:rgba(255,255,255,.06);
        }
        .a:hover{background:rgba(255,255,255,.10)}
        .empty{margin-top:18px;color:rgba(243,244,246,.65);text-align:center}
    </style>
</head>
<body>

<div class="topbar">
    <div class="topbar-inner">
        <a class="brand" th:href="@{/home}">
            <span class="brand-badge">LF</span>
            <span>Lost &amp; Found</span>
        </a>

        <div class="nav-links">
            <a class="link" th:href="@{/lost-items/create}" th:if="${#authorization.expression('isAuthenticated()')}">Create</a>
            <a class="link" th:href="@{/lost-items/my-items}" th:if="${#authorization.expression('isAuthenticated()')}">My Items</a>
            <a class="link" th:href="@{/admin/dashboard(tab='users')}" th:if="${#authorization.expression('hasRole(''ADMIN'')')}">Admin</a>

            <a class="link" th:href="@{/login}" th:if="${#authorization.expression('isAnonymous()')}">Login</a>
            <a class="link" th:href="@{/register}" th:if="${#authorization.expression('isAnonymous()')}">Register</a>

            <form th:action="@{/logout}" method="post" style="display:inline;" th:if="${#authorization.expression('isAuthenticated()')}">
                <button class="btn btn-danger" type="submit">Logout</button>
            </form>
        </div>
    </div>
</div>

<div class="container">

    <div class="panel">
        <div class="filters">
            <!-- Type filters (κρατάνε το status + q) -->
            <a class="pill"
               th:href="@{/home(type='ALL', status=${selectedStatus}, q=${q})}"
               th:classappend="${selectedType == 'ALL'} ? ' active' : ''">All</a>

            <a class="pill"
               th:href="@{/home(type='LOST', status=${selectedStatus}, q=${q})}"
               th:classappend="${selectedType == 'LOST'} ? ' active' : ''">Lost</a>

            <a class="pill"
               th:href="@{/home(type='FOUND', status=${selectedStatus}, q=${q})}"
               th:classappend="${selectedType == 'FOUND'} ? ' active' : ''">Found</a>

            <!-- Status filters (κρατάνε το type + q) -->
            <a class="pill"
               th:href="@{/home(type=${selectedType}, status='OPEN', q=${q})}"
               th:classappend="${selectedStatus == 'OPEN'} ? ' active' : ''">OPEN only</a>

            <a class="pill"
               th:href="@{/home(type=${selectedType}, status='ALL', q=${q})}"
               th:classappend="${selectedStatus == 'ALL'} ? ' active' : ''">Any status</a>
        </div>

        <form class="search" th:action="@{/home}" method="get">
            <input class="input" type="text" name="q" placeholder="Search by title or location..." th:value="${q}" />
            <input type="hidden" name="type" th:value="${selectedType}" />
            <input type="hidden" name="status" th:value="${selectedStatus}" />
            <button class="btn btn-primary" type="submit">Search</button>
            <a class="btn" th:href="@{/home(type=${selectedType}, status=${selectedStatus})}">Clear</a>
            <span class="small">Tip: try “wallet”, “athens”, “metro”, etc.</span>
        </form>
    </div>

    <div class="grid">
        <div class="card" th:each="it : ${items}">
            <div class="card-body">
                <div class="badges">
                    <span class="badge"
                          th:text="${it.type}"
                          th:classappend="${it.type != null && it.type.name() == 'LOST'} ? ' badge-type-lost' : ' badge-type-found'"></span>

                    <span class="badge"
                          th:text="${it.status}"
                          th:classappend="${it.status != null && it.status.name() == 'OPEN'} ? ' badge-open' : ' badge-resolved'"></span>
                </div>

                <h3 class="title" th:text="${it.title}"></h3>

                <div class="meta">
                    <div th:text="'Location: ' + (it.location != null ? it.location : 'N/A')"></div>
                    <div th:text="'Posted: ' + ${it.createdAt}"></div>
                    <div th:text="'By: ' + ${it.user != null ? it.user.username : 'N/A'}"></div>
                </div>
            </div>

            <img class="thumb" th:if="${it.imagePath}" th:src="${it.imagePath}" alt="item image"/>
            <img class="thumb" th:if="${it.imagePath == null}" th:src="@{/img/placeholder.png}" alt="no image" />

            <div class="card-actions">
                <a class="a" th:href="@{/items/{id}(id=${it.id})}">View details</a>
            </div>
        </div>
    </div>

    <div class="empty" th:if="${#lists.isEmpty(items)}">
        No items found.
    </div>

</div>
</body>
</html>
